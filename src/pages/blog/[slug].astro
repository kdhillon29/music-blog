---
export const prerender = true;
import { type CollectionEntry, getCollection, getEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { render } from "astro:content";
import Main from "../../components/Main.astro";
import H1 from "../../components/H1.astro";
import { Image } from "astro:assets";

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: post,
  }));
}
type Props = CollectionEntry<"posts">;

const post = Astro.props;
const { Content } = await render(post);

// const { slug } = Astro.params;
// const post = await getEntry("posts", slug as string);
if (!post) {
  return Astro.redirect("/404");
}
// const { Content } = await render(post);
---

<Layout title={post.data.title} description={post.slug}>
  <Main>
    <H1 text={post.data.title} />
    <Image
      loading="eager"
      src={post.data.image}
      alt={post.data.title}
      width={1024}
      height={1024 / 1.6}
      format="webp"
      class="rounded-2xl shadow-xl mb-6 mx-auto md:h-92 object-cover"
    />
    <div class="prose md:prose-xl mx-auto relative overflow-visible mb-20">
      <Content />
    </div>
  </Main>
</Layout>
